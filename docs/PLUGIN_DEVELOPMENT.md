# –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ –ø–ª–∞–≥–∏–Ω–æ–≤ –¥–ª—è Document Viewer

–≠—Ç–æ –ø–æ–¥—Ä–æ–±–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Å–æ–∑–¥–∞–Ω–∏—é —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã—Ö –ø–ª–∞–≥–∏–Ω–æ–≤ –¥–ª—è Document Viewer.

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [–í–≤–µ–¥–µ–Ω–∏–µ](#–≤–≤–µ–¥–µ–Ω–∏–µ)
- [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–ª–∞–≥–∏–Ω–æ–≤](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-–ø–ª–∞–≥–∏–Ω–æ–≤)
- [–°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Å—Ç–æ–≥–æ –ø–ª–∞–≥–∏–Ω–∞](#—Å–æ–∑–¥–∞–Ω–∏–µ-–ø—Ä–æ—Å—Ç–æ–≥–æ-–ø–ª–∞–≥–∏–Ω–∞)
- [–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å ViewerInterface](#–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å-viewerinterface)
- [–†–∞–±–æ—Ç–∞ —Å UI](#—Ä–∞–±–æ—Ç–∞-—Å-ui)
- [–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è](#—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ-—Å–æ—Å—Ç–æ—è–Ω–∏—è)
- [–ü–µ—á–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤](#–ø–µ—á–∞—Ç—å-–¥–æ–∫—É–º–µ–Ω—Ç–æ–≤)
- [–ü—Ä–∏–º–µ—Ä—ã](#–ø—Ä–∏–º–µ—Ä—ã)
- [–õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏](#–ª—É—á—à–∏–µ-–ø—Ä–∞–∫—Ç–∏–∫–∏)

## üéØ –í–≤–µ–¥–µ–Ω–∏–µ

Document Viewer –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–∏—Å—Ç–µ–º—É –ø–ª–∞–≥–∏–Ω–æ–≤ Qt –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ç–∏–ø–æ–≤ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤. –ö–∞–∂–¥—ã–π —Ç–∏–ø –¥–æ–∫—É–º–µ–Ω—Ç–∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω—ã–º –ø–ª–∞–≥–∏–Ω–æ–º, –∫–æ—Ç–æ—Ä—ã–π —Ä–µ–∞–ª–∏–∑—É–µ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å `ViewerInterface`.

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Å–∏—Å—Ç–µ–º—ã –ø–ª–∞–≥–∏–Ω–æ–≤

- ‚úÖ **–ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å**: –ö–∞–∂–¥—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞ - –æ—Ç–¥–µ–ª—å–Ω—ã–π –º–æ–¥—É–ª—å
- ‚úÖ **–†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å**: –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã
- ‚úÖ **–ù–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å**: –ü–ª–∞–≥–∏–Ω—ã –Ω–µ –∑–∞–≤–∏—Å—è—Ç –¥—Ä—É–≥ –æ—Ç –¥—Ä—É–≥–∞
- ‚úÖ **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞**: –ü–ª–∞–≥–∏–Ω—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–ª–∞–≥–∏–Ω–æ–≤

### –ò–µ—Ä–∞—Ä—Ö–∏—è –∫–ª–∞—Å—Å–æ–≤

```
QObject
    ‚îî‚îÄ‚îÄ ViewerInterface (—á–∏—Å—Ç—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å)
            ‚îî‚îÄ‚îÄ AbstractViewer (–±–∞–∑–æ–≤–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è)
                    ‚îî‚îÄ‚îÄ –í–∞—à –ø–ª–∞–≥–∏–Ω (–∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è)
```

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –ø–ª–∞–≥–∏–Ω–∞

1. **–ö–ª–∞—Å—Å –ø–ª–∞–≥–∏–Ω–∞** - —Ä–µ–∞–ª–∏–∑—É–µ—Ç `ViewerInterface`
2. **JSON –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ** - –æ–ø–∏—Å—ã–≤–∞—é—Ç –ø–ª–∞–≥–∏–Ω
3. **CMakeLists.txt** - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–±–æ—Ä–∫–∏
4. **UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã** - –≤–∏–¥–∂–µ—Ç—ã –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è

## üöÄ –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Å—Ç–æ–≥–æ –ø–ª–∞–≥–∏–Ω–∞

–°–æ–∑–¥–∞–¥–∏–º –ø—Ä–æ—Å—Ç–æ–π –ø–ª–∞–≥–∏–Ω –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ CSV —Ñ–∞–π–ª–æ–≤.

### –®–∞–≥ 1: –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π

```
plugins/
‚îî‚îÄ‚îÄ csvviewer/
    ‚îú‚îÄ‚îÄ CMakeLists.txt
    ‚îú‚îÄ‚îÄ csvviewer.h
    ‚îú‚îÄ‚îÄ csvviewer.cpp
    ‚îî‚îÄ‚îÄ csvviewer.json
```

### –®–∞–≥ 2: –ó–∞–≥–æ–ª–æ–≤–æ—á–Ω—ã–π —Ñ–∞–π–ª (csvviewer.h)

```cpp
#ifndef CSVVIEWER_H
#define CSVVIEWER_H

#include "viewerinterfaces.h"

QT_BEGIN_NAMESPACE
class QTableView;
class QStandardItemModel;
QT_END_NAMESPACE

class CsvViewer : public ViewerInterface
{
    Q_OBJECT
    // –£–∫–∞–∑—ã–≤–∞–µ–º IID –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –∏ JSON —Ñ–∞–π–ª —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏
    Q_PLUGIN_METADATA(IID "org.qt-project.Qt.Examples.DocumentViewer.ViewerInterface" 
                      FILE "csvviewer.json")
    Q_INTERFACES(ViewerInterface)

public:
    CsvViewer();
    ~CsvViewer() override;

    // –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
    void init(QFile *file, QWidget *parent, QMainWindow *mainWindow) override;
    QString viewerName() const override;
    QStringList supportedMimeTypes() const override;
    bool hasContent() const override;
    
    // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã
    QByteArray saveState() const override;
    bool restoreState(QByteArray &state) override;
    bool supportsOverview() const override { return false; }

#ifdef QT_DOCUMENTVIEWER_PRINTSUPPORT
protected:
    void printDocument(QPrinter *printer) const override;
#endif

private slots:
    void setupCsvUi();

private:
    bool parseFile();
    
    QTableView *m_tableView = nullptr;
    QStandardItemModel *m_model = nullptr;
};

#endif // CSVVIEWER_H
```

### –®–∞–≥ 3: –§–∞–π–ª —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ (csvviewer.cpp)

```cpp
#include "csvviewer.h"

#include <QFile>
#include <QTableView>
#include <QStandardItemModel>
#include <QTextStream>
#include <QHeaderView>
#include <QMainWindow>

#ifdef QT_DOCUMENTVIEWER_PRINTSUPPORT
#include <QPrinter>
#include <QPainter>
#endif

using namespace Qt::StringLiterals;

CsvViewer::CsvViewer()
    : m_model(new QStandardItemModel(this))
{
}

CsvViewer::~CsvViewer()
{
    // –£–º–Ω—ã–µ —É–∫–∞–∑–∞—Ç–µ–ª–∏ –∏ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–µ –æ–±—ä–µ–∫—Ç—ã Qt –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—á–∏—Å—Ç—è—Ç –ø–∞–º—è—Ç—å
}

void CsvViewer::init(QFile *file, QWidget *parent, QMainWindow *mainWindow)
{
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —É–∫–∞–∑–∞—Ç–µ–ª–∏
    ViewerInterface::init(file, parent, mainWindow);
    
    // –°–æ–∑–¥–∞–µ–º UI
    m_tableView = new QTableView(parent);
    m_tableView->setModel(m_model);
    m_tableView->horizontalHeader()->setStretchLastSection(true);
    
    // –ü–∞—Ä—Å–∏–º —Ñ–∞–π–ª
    if (parseFile()) {
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤–∏–¥–∂–µ—Ç –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
        statusString(tr("CSV file loaded successfully"));
    } else {
        statusString(tr("Failed to load CSV file"));
    }
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º UI –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏
    QMetaObject::invokeMethod(this, &CsvViewer::setupCsvUi, Qt::QueuedConnection);
}

QString CsvViewer::viewerName() const
{
    return QLatin1StringView(staticMetaObject.className());
}

QStringList CsvViewer::supportedMimeTypes() const
{
    // MIME-—Ç–∏–ø—ã, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø–ª–∞–≥–∏–Ω
    return QStringList{
        "text/csv"_L1,
        "text/comma-separated-values"_L1,
        "application/csv"_L1
    };
}

bool CsvViewer::hasContent() const
{
    return m_model && m_model->rowCount() > 0;
}

void CsvViewer::setupCsvUi()
{
    // –£–≤–µ–¥–æ–º–ª—è–µ–º, —á—Ç–æ UI –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω
    uiInitialized(m_tableView);
    
    // –°–æ–∑–¥–∞–µ–º –º–µ–Ω—é –∏ –¥–µ–π—Å—Ç–≤–∏—è
    auto *viewMenu = menuBar()->addMenu(tr("&View"));
    
    auto *fitColumnsAction = viewMenu->addAction(tr("Fit Columns"));
    connect(fitColumnsAction, &QAction::triggered, this, [this]() {
        m_tableView->resizeColumnsToContents();
    });
    
    auto *resetAction = viewMenu->addAction(tr("Reset View"));
    connect(resetAction, &QAction::triggered, this, [this]() {
        m_tableView->reset();
    });
    
    // –í–∫–ª—é—á–∞–µ–º –ø–µ—á–∞—Ç—å, –µ—Å–ª–∏ –µ—Å—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç
    printingEnabled(hasContent());
}

bool CsvViewer::parseFile()
{
    if (!m_file || !m_file->isOpen()) {
        if (m_file)
            m_file->open(QIODevice::ReadOnly | QIODevice::Text);
    }
    
    if (!m_file || !m_file->isOpen())
        return false;
    
    m_model->clear();
    QTextStream stream(m_file.get());
    
    bool firstRow = true;
    int columnCount = 0;
    
    while (!stream.atEnd()) {
        QString line = stream.readLine();
        QStringList fields = line.split(',');
        
        if (firstRow) {
            // –ü–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞ - –∑–∞–≥–æ–ª–æ–≤–∫–∏
            columnCount = fields.size();
            m_model->setHorizontalHeaderLabels(fields);
            firstRow = false;
        } else {
            // –î–∞–Ω–Ω—ã–µ
            QList<QStandardItem*> items;
            for (const QString &field : fields) {
                items.append(new QStandardItem(field.trimmed()));
            }
            m_model->appendRow(items);
        }
    }
    
    // –°–æ–æ–±—â–∞–µ–º, —á—Ç–æ –¥–æ–∫—É–º–µ–Ω—Ç –∑–∞–≥—Ä—É–∂–µ–Ω
    documentLoaded(m_file->fileName());
    
    return m_model->rowCount() > 0;
}

QByteArray CsvViewer::saveState() const
{
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —à–∏—Ä–∏–Ω—É –∫–æ–ª–æ–Ω–æ–∫)
    QByteArray state;
    QDataStream stream(&state, QIODevice::WriteOnly);
    
    if (m_tableView) {
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
        stream << m_tableView->horizontalHeader()->saveState();
    }
    
    return state;
}

bool CsvViewer::restoreState(QByteArray &state)
{
    if (state.isEmpty() || !m_tableView)
        return false;
    
    QDataStream stream(&state, QIODevice::ReadOnly);
    QByteArray headerState;
    stream >> headerState;
    
    return m_tableView->horizontalHeader()->restoreState(headerState);
}

#ifdef QT_DOCUMENTVIEWER_PRINTSUPPORT
void CsvViewer::printDocument(QPrinter *printer) const
{
    if (!hasContent() || !printer)
        return;
    
    // –ü—Ä–æ—Å—Ç–∞—è –ø–µ—á–∞—Ç—å —Ç–∞–±–ª–∏—Ü—ã
    QPainter painter(printer);
    
    // –ó–¥–µ—Å—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ª–æ–≥–∏–∫–∞ –ø–µ—á–∞—Ç–∏ —Ç–∞–±–ª–∏—Ü—ã
    // –î–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã –æ–ø—É—â–µ–Ω–∞
    
    painter.end();
    
    // –£–≤–µ–¥–æ–º–ª—è–µ–º –æ —Å—Ç–∞—Ç—É—Å–µ –ø–µ—á–∞—Ç–∏
    const_cast<CsvViewer*>(this)->printStatusChanged(
        AbstractViewer::PrintStatus::PrintSuccess
    );
}
#endif
```

### –®–∞–≥ 4: JSON –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (csvviewer.json)

```json
{
    "Name": "CsvViewer",
    "Description": "Viewer for CSV (Comma-Separated Values) files",
    "Version": "1.0.0",
    "Author": "Your Name",
    "License": "BSD-3-Clause",
    "MimeTypes": [
        "text/csv",
        "text/comma-separated-values",
        "application/csv"
    ],
    "FileExtensions": [
        "csv",
        "tsv"
    ],
    "Features": [
        "view",
        "print"
    ]
}
```

### –®–∞–≥ 5: CMakeLists.txt

```cmake
# CSV Viewer Plugin

qt_add_plugin(csvviewer)

target_sources(csvviewer PRIVATE
    csvviewer.cpp
    csvviewer.h
)

target_link_libraries(csvviewer PRIVATE
    Qt6::Core
    Qt6::Gui
    Qt6::Widgets
)

# –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–µ—á–∞—Ç–∏
if(TARGET Qt6::PrintSupport)
    target_link_libraries(csvviewer PRIVATE Qt6::PrintSupport)
endif()

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–ª–∞–≥–∏–Ω –≤ –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
install(TARGETS csvviewer
    LIBRARY DESTINATION ${CMAKE_INSTALL_LIBDIR}/plugins
    RUNTIME DESTINATION ${CMAKE_INSTALL_BINDIR}/plugins
)
```

### –®–∞–≥ 6: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤ –≥–ª–∞–≤–Ω–æ–º CMakeLists.txt

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `plugins/CMakeLists.txt`:

```cmake
add_subdirectory(txtviewer)
add_subdirectory(imageviewer)
add_subdirectory(jsonviewer)
add_subdirectory(pdfviewer)
add_subdirectory(q3dviewer)
add_subdirectory(csvviewer)  # –î–æ–±–∞–≤—å—Ç–µ —ç—Ç—É —Å—Ç—Ä–æ–∫—É
```

## üé® –†–∞–±–æ—Ç–∞ —Å UI

### –°–æ–∑–¥–∞–Ω–∏–µ –º–µ–Ω—é

```cpp
void MyViewer::setupUi()
{
    // –ü–æ–ª—É—á–∞–µ–º –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
    QMenuBar *menu = menuBar();
    
    // –°–æ–∑–¥–∞–µ–º —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–µ –º–µ–Ω—é
    QMenu *myMenu = menu->addMenu(tr("My Menu"));
    
    // –î–æ–±–∞–≤–ª—è–µ–º –¥–µ–π—Å—Ç–≤–∏—è
    QAction *action1 = myMenu->addAction(tr("Action 1"));
    connect(action1, &QAction::triggered, this, &MyViewer::onAction1);
    
    // –î–µ–π—Å—Ç–≤–∏–µ —Å –∏–∫–æ–Ω–∫–æ–π –∏ –≥–æ—Ä—è—á–µ–π –∫–ª–∞–≤–∏—à–µ–π
    QAction *action2 = myMenu->addAction(
        QIcon(":/images/icon.png"), 
        tr("Action 2")
    );
    action2->setShortcut(QKeySequence::Refresh);
    connect(action2, &QAction::triggered, this, &MyViewer::onAction2);
}
```

### –°–æ–∑–¥–∞–Ω–∏–µ –ø–∞–Ω–µ–ª–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤

```cpp
void MyViewer::setupToolbar()
{
    // –°–æ–∑–¥–∞–µ–º –ø–∞–Ω–µ–ª—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
    QToolBar *toolbar = new QToolBar(tr("My Toolbar"), mainWindow());
    
    // –î–æ–±–∞–≤–ª—è–µ–º –¥–µ–π—Å—Ç–≤–∏—è
    toolbar->addAction(QIcon(":/images/zoom-in.png"), tr("Zoom In"), 
                      this, &MyViewer::zoomIn);
    toolbar->addAction(QIcon(":/images/zoom-out.png"), tr("Zoom Out"), 
                      this, &MyViewer::zoomOut);
    
    toolbar->addSeparator();
    
    // –î–æ–±–∞–≤–ª—è–µ–º –≤–∏–¥–∂–µ—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∫–æ–º–±–æ–±–æ–∫—Å)
    QComboBox *combo = new QComboBox(toolbar);
    combo->addItems({"Option 1", "Option 2", "Option 3"});
    toolbar->addWidget(combo);
    
    // –î–æ–±–∞–≤–ª—è–µ–º –ø–∞–Ω–µ–ª—å –≤ –≥–ª–∞–≤–Ω–æ–µ –æ–∫–Ω–æ
    mainWindow()->addToolBar(Qt::TopToolBarArea, toolbar);
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è
    addedToolBars(toolbar);
}
```

### –†–∞–±–æ—Ç–∞ —Å –æ–±–∑–æ—Ä–æ–º (Overview)

–ï—Å–ª–∏ –≤–∞—à –ø–ª–∞–≥–∏–Ω –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –æ–±–∑–æ—Ä (thumbnails, bookmarks):

```cpp
bool MyViewer::supportsOverview() const
{
    return true;  // –í–∫–ª—é—á–∞–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É
}

void MyViewer::setupOverview()
{
    // –°–æ–∑–¥–∞–µ–º –≤–∏–¥–∂–µ—Ç –¥–ª—è –∑–∞–∫–ª–∞–¥–æ–∫
    QListWidget *bookmarks = new QListWidget(parent());
    bookmarks->addItems({"Chapter 1", "Chapter 2", "Chapter 3"});
    
    connect(bookmarks, &QListWidget::itemClicked, 
            this, &MyViewer::onBookmarkClicked);
    
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤–∏–¥–∂–µ—Ç –∑–∞–∫–ª–∞–¥–æ–∫
    setBookmarkWidget(bookmarks);
    
    // –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –¥–ª—è –º–∏–Ω–∏–∞—Ç—é—Ä
    QListView *thumbnails = new QListView(parent());
    // ... –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ thumbnails
    setPageWidget(thumbnails);
}
```

## üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è

```cpp
QByteArray MyViewer::saveState() const
{
    QByteArray data;
    QDataStream stream(&data, QIODevice::WriteOnly);
    
    // –í–µ—Ä—Å–∏—è —Ñ–æ—Ä–º–∞—Ç–∞
    stream << quint32(1);
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
    stream << m_zoomLevel;
    stream << m_currentPage;
    stream << m_viewMode;
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤–∏–¥–∂–µ—Ç–æ–≤
    if (m_tableView) {
        stream << m_tableView->horizontalHeader()->saveState();
    }
    
    return data;
}

bool MyViewer::restoreState(QByteArray &state)
{
    if (state.isEmpty())
        return false;
    
    QDataStream stream(&state, QIODevice::ReadOnly);
    
    quint32 version;
    stream >> version;
    
    if (version != 1)
        return false;
    
    // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
    stream >> m_zoomLevel;
    stream >> m_currentPage;
    stream >> m_viewMode;
    
    // –ü—Ä–∏–º–µ–Ω—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
    applyZoom(m_zoomLevel);
    gotoPage(m_currentPage);
    
    return true;
}
```

## üñ®Ô∏è –ü–µ—á–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

```cpp
#ifdef QT_DOCUMENTVIEWER_PRINTSUPPORT
void MyViewer::printDocument(QPrinter *printer) const
{
    if (!printer || !hasContent())
        return;
    
    // –£–≤–µ–¥–æ–º–ª—è–µ–º –æ –Ω–∞—á–∞–ª–µ –ø–µ—á–∞—Ç–∏
    const_cast<MyViewer*>(this)->printStatusChanged(
        AbstractViewer::PrintStatus::PrintInProgress
    );
    
    QPainter painter;
    if (!painter.begin(printer)) {
        const_cast<MyViewer*>(this)->printStatusChanged(
            AbstractViewer::PrintStatus::PrintError
        );
        return;
    }
    
    // –õ–æ–≥–∏–∫–∞ –ø–µ—á–∞—Ç–∏
    for (int page = 0; page < totalPages(); ++page) {
        if (page > 0)
            printer->newPage();
        
        // –†–∏—Å—É–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É
        drawPage(&painter, page, printer->pageRect());
    }
    
    painter.end();
    
    // –£–≤–µ–¥–æ–º–ª—è–µ–º –æ–± —É—Å–ø–µ—Ö–µ
    const_cast<MyViewer*>(this)->printStatusChanged(
        AbstractViewer::PrintStatus::PrintSuccess
    );
}
#endif
```

## üìö –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

### 1. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç—å—é

```cpp
// ‚úÖ –•–æ—Ä–æ—à–æ: –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–µ –æ–±—ä–µ–∫—Ç—ã Qt
m_widget = new QWidget(parent());

// ‚úÖ –•–æ—Ä–æ—à–æ: –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —É–º–Ω—ã–µ —É–∫–∞–∑–∞—Ç–µ–ª–∏ –¥–ª—è non-Qt –æ–±—ä–µ–∫—Ç–æ–≤
std::unique_ptr<MyClass> m_data;

// ‚ùå –ü–ª–æ—Ö–æ: —Ä—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç—å—é
MyClass *data = new MyClass();  // –ö—Ç–æ —É–¥–∞–ª–∏—Ç?
```

### 2. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

```cpp
bool MyViewer::openFile()
{
    if (!m_file || !m_file->exists()) {
        statusString(tr("File does not exist"));
        return false;
    }
    
    if (!m_file->open(QIODevice::ReadOnly)) {
        statusString(tr("Cannot open file: %1")
            .arg(m_file->errorString()));
        return false;
    }
    
    // ... –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–π–ª–∞
    
    return true;
}
```

### 3. –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞

–î–ª—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é –∑–∞–≥—Ä—É–∑–∫—É:

```cpp
void MyViewer::loadFileAsync()
{
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
    statusString(tr("Loading..."));
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º –≤ –¥—Ä—É–≥–æ–º –ø–æ—Ç–æ–∫–µ
    QFuture<bool> future = QtConcurrent::run([this]() {
        return parseFile();
    });
    
    // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    auto *watcher = new QFutureWatcher<bool>(this);
    connect(watcher, &QFutureWatcher<bool>::finished, this, [this, watcher]() {
        if (watcher->result()) {
            statusString(tr("Loaded successfully"));
            documentLoaded(m_file->fileName());
        } else {
            statusString(tr("Failed to load file"));
        }
        watcher->deleteLater();
    });
    
    watcher->setFuture(future);
}
```

### 4. –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è

```cpp
// –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ tr() –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Å—Ç—Ä–æ–∫
QString message = tr("File loaded: %1 rows").arg(rowCount);

// –î–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —á–∏—Å–ª–∞
QString message = tr("%n file(s) found", "", fileCount);
```

### 5. MIME-—Ç–∏–ø—ã

```cpp
QStringList MyViewer::supportedMimeTypes() const
{
    // –í–æ–∑–≤—Ä–∞—â–∞–π—Ç–µ –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ MIME-—Ç–∏–ø—ã
    return QStringList{
        "text/markdown"_L1,
        "text/x-markdown"_L1,
        "text/plain"_L1  // Fallback
    };
}
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–ª–∞–≥–∏–Ω–∞

```bash
# –°–æ–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç
cmake --build build

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø–ª–∞–≥–∏–Ω —Å–æ–∑–¥–∞–Ω
ls build/plugins/myviewer/

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å –æ—Ç–ª–∞–¥–∫–æ–π –ø–ª–∞–≥–∏–Ω–æ–≤
export QT_DEBUG_PLUGINS=1
./build/app/documentviewer

# –û—Ç–∫—Ä–æ–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª
./build/app/documentviewer test.csv
```

## üìñ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [Qt Plugin System](https://doc.qt.io/qt-6/plugins-howto.html)
- [viewerinterfaces.h](../app/viewerinterfaces.h) - –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
- [abstractviewer.h](../app/abstractviewer.h) - –±–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å
- –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–ª–∞–≥–∏–Ω—ã –≤ `plugins/` - –ø—Ä–∏–º–µ—Ä—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

---

**–£–¥–∞—á–∏ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ –ø–ª–∞–≥–∏–Ω–æ–≤!** üöÄ

